<div class="chat-wrapper">
  <div #chatContainer class="chat-container">
    <div *ngFor="let msg of mensajes"
         class="chat-message"
         [ngClass]="{ 'from-me': msg.fromMe, 'from-them': !msg.fromMe }">

      <div class="bubble">
        <!-- Texto -->
        <span *ngIf="!msg.objeto" class="text">{{ msg.mensaje }}</span>

        <!-- Imagen con click -->
        <img *ngIf="msg.tipo === 'imagen'"
             [src]="msg.objeto"
             class="chat-image"
             (click)="openImageModal(msg.objeto)" />

        <!-- Sticker -->
        <img *ngIf="msg.tipo === 'sticker'" [src]="msg.objeto" class="chat-sticker" />

        <!-- Audio -->
        <audio *ngIf="msg.tipo === 'audio'" controls>
          <source [src]="msg.objeto" type="audio/ogg" />
        </audio>

        <!-- Video -->
        <video *ngIf="msg.tipo === 'video'" controls class="chat-video">
          <source [src]="msg.objeto" type="video/mp4" />
        </video>

        <span class="timestamp">{{ msg.fecha | date:'shortTime' }}</span>
      </div>
    </div>
  </div>

  <div class="chat-input">
    <input
      type="text"
      [(ngModel)]="nuevoMensaje"
      placeholder="Escribe un mensaje"
      (keyup.enter)="enviarMensaje()"
    />
    <button (click)="enviarMensaje()">âž¤</button>
  </div>
</div>

<!-- ðŸ”¹ Modal de imagen -->
<div class="image-modal" *ngIf="showImageModal" (click)="closeImageModal()">
  <div class="image-modal-content" (click)="$event.stopPropagation()">
    <img [src]="selectedImagen" alt="Imagen" />
    <button class="close-btn" (click)="closeImageModal()">âœ–</button>
  </div>
</div>
